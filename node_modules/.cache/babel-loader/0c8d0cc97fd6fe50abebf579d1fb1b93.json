{"ast":null,"code":"import{useContext,useMemo}from'react';import{MapContainer,TileLayer,Polygon,useMap,Tooltip}from'react-leaflet';import'leaflet/dist/leaflet.css';import L,{latLngBounds}from'leaflet';import{apiKey,serviceUrl}from'../helpers';import{aonbArea,aonbOptions}from'../data/chilternsAonbArea';import{StateContext}from'../MapApp';import Markers from'./markers/Markers';import Routes from'./routes/Routes';import MapStyles from'./Map.styles';/**\n * Render map\n */import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function map(){// const [mapZoom, setMapZoom] = useState(10)\n// eslint-disable-next-line react-hooks/rules-of-hooks\nvar _ref=useContext(StateContext),state=_ref.state;var showAonbArea=state.showAonbArea,markerData=state.markerData,routeData=state.routeData,infoBarContent=state.infoBarContent,activeMarkerFilters=state.activeMarkerFilters,activeRouteFilters=state.activeRouteFilters;// function windowSize() {\n//   window.innerWidth < 1024 ? setMapZoom(8) : setMapZoom(12)\n//   console.log(window.innerWidth < 1024)\n//   if (window.innerWidth < 1024) {\n//     setMapZoom(8)\n//   }\n//   console.log(mapZoom)\n// }\n// Set map default zoom based on screen size\n// useEffect(() => {\n//   windowSize()\n//   window.addEventListener('resize', () => {\n//     setTimeout(windowSize, 200)\n//   })\n// }, [])\n// Set bounds of map based on available markers\nfunction SetBounds(){// When filters are empty, don't relocate map focus\nif(activeMarkerFilters.length===0&&activeRouteFilters.length===0){return null;}// eslint-disable-next-line react-hooks/rules-of-hooks\nvar map=useMap();// Get active markers\nvar currentMarkers=markerData.filter(function(marker){var _marker$categories;var matchedCategory=(_marker$categories=marker.categories)===null||_marker$categories===void 0?void 0:_marker$categories.filter(function(id){return activeMarkerFilters.indexOf(id)!==-1;});if(!matchedCategory)return null;return matchedCategory.length>0;});// Get lat/lng for each active marker\nvar markerPositions=currentMarkers.map(function(marker){return marker.position;});if(markerPositions.length){// eslint-disable-next-line @typescript-eslint/no-unused-vars, react-hooks/rules-of-hooks -- map.fitBounds needs to be used\nvar mapBounds=useMemo(function(){// Generate bounds based on current marker data\nvar bounds=latLngBounds(markerPositions);markerPositions.forEach(function(coords){bounds.extend(coords);});// Update bounds of map\nmap.flyToBounds(bounds,{padding:[0,0],maxZoom:13});return bounds;},[map,markerPositions]);}return null;}return/*#__PURE__*/_jsxs(MapStyles,{className:\"\".concat(infoBarContent&&'disabled'),children:[/*#__PURE__*/_jsxs(MapContainer,{style:{width:'100%',height:'100%'},zoom:10,maxZoom:18,minZoom:8,scrollWheelZoom:false,center:[51.6858401,-0.79],dragging:!L.Browser.mobile,children:[/*#__PURE__*/_jsx(TileLayer,{attribution:\"Contains OS data &copy; Crown copyright and database rights \".concat(new Date().getFullYear()),url:\"\".concat(serviceUrl,\"/Outdoor_3857/{z}/{x}/{y}.png?key=\").concat(apiKey)}),markerData&&/*#__PURE__*/_jsx(Markers,{}),routeData&&/*#__PURE__*/_jsx(Routes,{}),showAonbArea&&/*#__PURE__*/_jsx(Polygon,{pathOptions:aonbOptions,positions:aonbArea,children:/*#__PURE__*/_jsx(Tooltip,{sticky:true,children:\"Chilterns AONB area\"})}),/*#__PURE__*/_jsx(SetBounds,{})]}),/*#__PURE__*/_jsx(\"span\",{className:\"os-api-branding logo\"})]});}","map":{"version":3,"names":["useContext","useMemo","MapContainer","TileLayer","Polygon","useMap","Tooltip","L","latLngBounds","apiKey","serviceUrl","aonbArea","aonbOptions","StateContext","Markers","Routes","MapStyles","map","state","showAonbArea","markerData","routeData","infoBarContent","activeMarkerFilters","activeRouteFilters","SetBounds","length","currentMarkers","filter","marker","matchedCategory","categories","id","indexOf","markerPositions","position","mapBounds","bounds","forEach","coords","extend","flyToBounds","padding","maxZoom","width","height","Browser","mobile","Date","getFullYear"],"sources":["/Users/harryedwards/Work/FL/_examples/mapping/src/components/Map.tsx"],"sourcesContent":["import { useContext, useMemo } from 'react'\nimport {\n  MapContainer,\n  TileLayer,\n  Polygon,\n  useMap,\n  Tooltip,\n} from 'react-leaflet'\nimport 'leaflet/dist/leaflet.css'\nimport L, { latLngBounds, LatLngExpression } from 'leaflet'\nimport { apiKey, serviceUrl } from '../helpers'\nimport { aonbArea, aonbOptions } from '../data/chilternsAonbArea'\nimport { StateContext } from '../MapApp'\nimport { MarkerEntity, StateContextT } from '../utils/types'\nimport Markers from './markers/Markers'\nimport Routes from './routes/Routes'\nimport MapStyles from './Map.styles'\n\n/**\n * Render map\n */\nexport default function map() {\n  // const [mapZoom, setMapZoom] = useState(10)\n\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  const { state } = useContext(StateContext) as StateContextT\n  const {\n    showAonbArea,\n    markerData,\n    routeData,\n    infoBarContent,\n    activeMarkerFilters,\n    activeRouteFilters,\n  } = state\n\n  // function windowSize() {\n  //   window.innerWidth < 1024 ? setMapZoom(8) : setMapZoom(12)\n  //   console.log(window.innerWidth < 1024)\n\n  //   if (window.innerWidth < 1024) {\n  //     setMapZoom(8)\n  //   }\n\n  //   console.log(mapZoom)\n  // }\n\n  // Set map default zoom based on screen size\n  // useEffect(() => {\n  //   windowSize()\n\n  //   window.addEventListener('resize', () => {\n  //     setTimeout(windowSize, 200)\n  //   })\n  // }, [])\n\n  // Set bounds of map based on available markers\n  function SetBounds(): any {\n    // When filters are empty, don't relocate map focus\n    if (activeMarkerFilters.length === 0 && activeRouteFilters.length === 0) {\n      return null\n    }\n\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const map = useMap()\n\n    // Get active markers\n    const currentMarkers = markerData.filter(marker => {\n      const matchedCategory = marker.categories?.filter(function (id) {\n        return activeMarkerFilters.indexOf(id) !== -1\n      })\n      if (!matchedCategory) return null\n      return matchedCategory.length > 0\n    })\n\n    // Get lat/lng for each active marker\n    const markerPositions = currentMarkers.map((marker: MarkerEntity) => {\n      return marker.position\n    })\n\n    if (markerPositions.length) {\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars, react-hooks/rules-of-hooks -- map.fitBounds needs to be used\n      const mapBounds = useMemo(() => {\n        // Generate bounds based on current marker data\n        const bounds = latLngBounds(markerPositions)\n        markerPositions.forEach((coords: LatLngExpression) => {\n          bounds.extend(coords)\n        })\n\n        // Update bounds of map\n        map.flyToBounds(bounds, { padding: [0, 0], maxZoom: 13 })\n        return bounds\n      }, [map, markerPositions])\n    }\n\n    return null\n  }\n\n  return (\n    <MapStyles className={`${infoBarContent && 'disabled'}`}>\n      <MapContainer\n        style={{ width: '100%', height: '100%' }}\n        zoom={10}\n        maxZoom={18}\n        minZoom={8}\n        scrollWheelZoom={false}\n        center={[51.6858401, -0.79]}\n        dragging={!L.Browser.mobile}\n      >\n        <TileLayer\n          attribution={`Contains OS data &copy; Crown copyright and database rights ${new Date().getFullYear()}`}\n          url={`${serviceUrl}/Outdoor_3857/{z}/{x}/{y}.png?key=${apiKey}`}\n        />\n\n        {markerData && <Markers />}\n\n        {routeData && <Routes />}\n\n        {showAonbArea && (\n          <Polygon pathOptions={aonbOptions} positions={aonbArea}>\n            <Tooltip sticky={true}>Chilterns AONB area</Tooltip>\n          </Polygon>\n        )}\n\n        <SetBounds />\n      </MapContainer>\n      <span className=\"os-api-branding logo\"></span>\n    </MapStyles>\n  )\n}\n"],"mappings":"AAAA,OAASA,UAAT,CAAqBC,OAArB,KAAoC,OAApC,CACA,OACEC,YADF,CAEEC,SAFF,CAGEC,OAHF,CAIEC,MAJF,CAKEC,OALF,KAMO,eANP,CAOA,MAAO,0BAAP,CACA,MAAOC,EAAP,EAAYC,YAAZ,KAAkD,SAAlD,CACA,OAASC,MAAT,CAAiBC,UAAjB,KAAmC,YAAnC,CACA,OAASC,QAAT,CAAmBC,WAAnB,KAAsC,2BAAtC,CACA,OAASC,YAAT,KAA6B,WAA7B,CAEA,MAAOC,QAAP,KAAoB,mBAApB,CACA,MAAOC,OAAP,KAAmB,iBAAnB,CACA,MAAOC,UAAP,KAAsB,cAAtB,CAEA;AACA;AACA,G,wFACA,cAAe,SAASC,IAAT,EAAe,CAC5B;AAEA;AACA,SAAkBjB,UAAU,CAACa,YAAD,CAA5B,CAAQK,KAAR,MAAQA,KAAR,CACA,GACEC,aADF,CAOID,KAPJ,CACEC,YADF,CAEEC,UAFF,CAOIF,KAPJ,CAEEE,UAFF,CAGEC,SAHF,CAOIH,KAPJ,CAGEG,SAHF,CAIEC,cAJF,CAOIJ,KAPJ,CAIEI,cAJF,CAKEC,mBALF,CAOIL,KAPJ,CAKEK,mBALF,CAMEC,kBANF,CAOIN,KAPJ,CAMEM,kBANF,CASA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA,QAASC,UAAT,EAA0B,CACxB;AACA,GAAIF,mBAAmB,CAACG,MAApB,GAA+B,CAA/B,EAAoCF,kBAAkB,CAACE,MAAnB,GAA8B,CAAtE,CAAyE,CACvE,MAAO,KAAP,CACD,CAED;AACA,GAAMT,IAAG,CAAGZ,MAAM,EAAlB,CAEA;AACA,GAAMsB,eAAc,CAAGP,UAAU,CAACQ,MAAX,CAAkB,SAAAC,MAAM,CAAI,wBACjD,GAAMC,gBAAe,qBAAGD,MAAM,CAACE,UAAV,6CAAG,mBAAmBH,MAAnB,CAA0B,SAAUI,EAAV,CAAc,CAC9D,MAAOT,oBAAmB,CAACU,OAApB,CAA4BD,EAA5B,IAAoC,CAAC,CAA5C,CACD,CAFuB,CAAxB,CAGA,GAAI,CAACF,eAAL,CAAsB,MAAO,KAAP,CACtB,MAAOA,gBAAe,CAACJ,MAAhB,CAAyB,CAAhC,CACD,CANsB,CAAvB,CAQA;AACA,GAAMQ,gBAAe,CAAGP,cAAc,CAACV,GAAf,CAAmB,SAACY,MAAD,CAA0B,CACnE,MAAOA,OAAM,CAACM,QAAd,CACD,CAFuB,CAAxB,CAIA,GAAID,eAAe,CAACR,MAApB,CAA4B,CAC1B;AACA,GAAMU,UAAS,CAAGnC,OAAO,CAAC,UAAM,CAC9B;AACA,GAAMoC,OAAM,CAAG7B,YAAY,CAAC0B,eAAD,CAA3B,CACAA,eAAe,CAACI,OAAhB,CAAwB,SAACC,MAAD,CAA8B,CACpDF,MAAM,CAACG,MAAP,CAAcD,MAAd,EACD,CAFD,EAIA;AACAtB,GAAG,CAACwB,WAAJ,CAAgBJ,MAAhB,CAAwB,CAAEK,OAAO,CAAE,CAAC,CAAD,CAAI,CAAJ,CAAX,CAAmBC,OAAO,CAAE,EAA5B,CAAxB,EACA,MAAON,OAAP,CACD,CAVwB,CAUtB,CAACpB,GAAD,CAAMiB,eAAN,CAVsB,CAAzB,CAWD,CAED,MAAO,KAAP,CACD,CAED,mBACE,MAAC,SAAD,EAAW,SAAS,WAAKZ,cAAc,EAAI,UAAvB,CAApB,wBACE,MAAC,YAAD,EACE,KAAK,CAAE,CAAEsB,KAAK,CAAE,MAAT,CAAiBC,MAAM,CAAE,MAAzB,CADT,CAEE,IAAI,CAAE,EAFR,CAGE,OAAO,CAAE,EAHX,CAIE,OAAO,CAAE,CAJX,CAKE,eAAe,CAAE,KALnB,CAME,MAAM,CAAE,CAAC,UAAD,CAAa,CAAC,IAAd,CANV,CAOE,QAAQ,CAAE,CAACtC,CAAC,CAACuC,OAAF,CAAUC,MAPvB,wBASE,KAAC,SAAD,EACE,WAAW,uEAAiE,GAAIC,KAAJ,GAAWC,WAAX,EAAjE,CADb,CAEE,GAAG,WAAKvC,UAAL,8CAAoDD,MAApD,CAFL,EATF,CAcGW,UAAU,eAAI,KAAC,OAAD,IAdjB,CAgBGC,SAAS,eAAI,KAAC,MAAD,IAhBhB,CAkBGF,YAAY,eACX,KAAC,OAAD,EAAS,WAAW,CAAEP,WAAtB,CAAmC,SAAS,CAAED,QAA9C,uBACE,KAAC,OAAD,EAAS,MAAM,CAAE,IAAjB,iCADF,EAnBJ,cAwBE,KAAC,SAAD,IAxBF,GADF,cA2BE,aAAM,SAAS,CAAC,sBAAhB,EA3BF,GADF,CA+BD"},"metadata":{},"sourceType":"module"}