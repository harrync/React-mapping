{"ast":null,"code":"import _slicedToArray from\"/Users/harryedwards/Work/FL/_examples/mapping/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useContext,useEffect,useState}from'react';import{htmlDecode}from'../../helpers';import{DispatchContext,StateContext}from'../../MapApp';import Button from'../../ui/Button';import{AppState}from'../../utils/types';import{AnimatePresence,motion}from'framer-motion';import{markerIcons}from'../../data/markerIcons';import updateActiveCategories from'../../hooks/updateActiveCategories';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";/**\n * Top level marker categories, rendering out the parent & child categories\n */export default function MarkerCategory(_ref){var category=_ref.category;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),open=_useState2[0],setOpen=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),currentTids=_useState4[0],setCurrentTids=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isSelected=_useState6[0],setIsSelected=_useState6[1];var _ref2=useContext(DispatchContext),dispatch=_ref2.dispatch;var _ref3=useContext(StateContext),state=_ref3.state;var activeMarkerFilters=state.activeMarkerFilters,mapRef=state.mapRef;useEffect(function(){// If a tid from this cateogry is in state, set selected class to category toggle\nvar isCategorySelected=currentTids.filter(function(tid){var tidsMatch=currentTids.length>0||tid.filter(function(term){return activeMarkerFilters.includes(term);}).length;return tidsMatch!==undefined;});setIsSelected(isCategorySelected.length>0?true:false);// If no filters are selected, reset state to intital\nif(activeMarkerFilters.length===0){setIsSelected(false);setCurrentTids([]);}},[activeMarkerFilters,currentTids]);// Hide/show category buttons\nfunction handleToggleCategory(){setOpen(!open);}function handleParentCategoryFilter(tid,children){// Get child term IDs as array to cross reference against state\nvar childTids=children.map(function(term){return term.tid;});// If child terms are present, remove them\nvar childrenToRemove=activeMarkerFilters.filter(function(el){return childTids.includes(el);});// Remove child TIDs from state - look in to more performant way to achieve this\nif(childrenToRemove.length>0)childrenToRemove.forEach(function(tid){dispatch({type:AppState.ACTIVE_MARKER_CATEGORIES,mode:tid});});// Add parent TID to state\ndispatch({type:AppState.ACTIVE_MARKER_CATEGORIES,mode:tid});// Toggle category in/out of state to manage parent button selected state\nvar updatedTids=updateActiveCategories(tid,currentTids,mapRef);setCurrentTids(updatedTids);}function handleChildCategoryFilter(childTid,parentTid){// Check if parent TID is in state, if so, remove it\nif(activeMarkerFilters.includes(parentTid)){dispatch({type:AppState.ACTIVE_MARKER_CATEGORIES,mode:parentTid});}// Add child TID to state\ndispatch({type:AppState.ACTIVE_MARKER_CATEGORIES,mode:childTid});// Toggle category in/out of state to manage parent button selected state\nvar updatedTids=updateActiveCategories(childTid,currentTids,mapRef);setCurrentTids(updatedTids);}function checkHasIcon(term){var hasIcon=markerIcons.filter(function(icon){return term.tid===icon;});return/*#__PURE__*/_jsx(\"img\",{src:\"\".concat(window.location.origin,\"/wp-content/themes/chilterns/dist/img/map/plain/\").concat(hasIcon?+hasIcon:0,\".svg\"),alt:\"Marker icon\"});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Button,{classes:\"category-label \".concat(open&&'active',\" \").concat(isSelected&&'selected'),clicked:handleToggleCategory,ariaLabel:\"Click to toggle \".concat(htmlDecode(category.name),\" category filters\"),\"data-tid\":category.tid,children:[/*#__PURE__*/_jsx(\"span\",{role:\"img\",\"aria-label\":\"Category arrow\"}),htmlDecode(category.name)]}),/*#__PURE__*/_jsx(AnimatePresence,{children:open&&/*#__PURE__*/_jsxs(motion.div,{className:\"filters-dropdown\",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:'easeInOut'},children:[/*#__PURE__*/_jsxs(Button,{clicked:function clicked(){return handleParentCategoryFilter(category.tid,category.children);},classes:\"category \".concat(activeMarkerFilters.includes(category.tid)&&'active'),children:[/*#__PURE__*/_jsx(\"span\",{className:\"check\",role:\"checkbox\",\"aria-checked\":activeMarkerFilters.includes(category.tid),\"aria-label\":\"Visual check for category\"}),\"See all \",htmlDecode(category.name),checkHasIcon(category)]}),category.children.map(function(childCategory){return/*#__PURE__*/_jsxs(Button,{clicked:function clicked(){return handleChildCategoryFilter(childCategory.tid,category.tid);},classes:\"category \".concat(activeMarkerFilters.includes(childCategory.tid)&&'active'),children:[/*#__PURE__*/_jsx(\"span\",{className:\"check\",role:\"checkbox\",\"aria-checked\":activeMarkerFilters.includes(childCategory.tid),\"aria-label\":\"Visual check for category\"}),htmlDecode(childCategory.name),checkHasIcon(childCategory)]},childCategory.tid);})]})})]});}","map":{"version":3,"names":["useContext","useEffect","useState","htmlDecode","DispatchContext","StateContext","Button","AppState","AnimatePresence","motion","markerIcons","updateActiveCategories","MarkerCategory","category","open","setOpen","currentTids","setCurrentTids","isSelected","setIsSelected","dispatch","state","activeMarkerFilters","mapRef","isCategorySelected","filter","tid","tidsMatch","length","term","includes","undefined","handleToggleCategory","handleParentCategoryFilter","children","childTids","map","childrenToRemove","el","forEach","type","ACTIVE_MARKER_CATEGORIES","mode","updatedTids","handleChildCategoryFilter","childTid","parentTid","checkHasIcon","hasIcon","icon","window","location","origin","name","opacity","ease","childCategory"],"sources":["/Users/harryedwards/Work/FL/_examples/mapping/src/components/filters/MarkerCategory.tsx"],"sourcesContent":["import { useContext, useEffect, useState } from 'react'\nimport { htmlDecode } from '../../helpers'\nimport { DispatchContext, StateContext } from '../../MapApp'\nimport Button from '../../ui/Button'\nimport {\n  AppState,\n  DispatchContextT,\n  StateContextT,\n  TaxonomyEntity,\n} from '../../utils/types'\nimport { AnimatePresence, motion } from 'framer-motion'\nimport { markerIcons } from '../../data/markerIcons'\nimport updateActiveCategories from '../../hooks/updateActiveCategories'\n\ntype Props = {\n  category: TaxonomyEntity\n}\n\n/**\n * Top level marker categories, rendering out the parent & child categories\n */\nexport default function MarkerCategory({ category }: Props) {\n  const [open, setOpen] = useState<boolean>(false)\n  const [currentTids, setCurrentTids] = useState<any[]>([])\n  const [isSelected, setIsSelected] = useState<boolean>(false)\n  const { dispatch } = useContext(DispatchContext) as DispatchContextT\n  const { state } = useContext(StateContext) as StateContextT\n  const { activeMarkerFilters, mapRef } = state\n\n  useEffect(() => {\n    // If a tid from this cateogry is in state, set selected class to category toggle\n    const isCategorySelected = currentTids.filter(tid => {\n      const tidsMatch =\n        currentTids.length > 0 ||\n        tid.filter((term: number) => {\n          return activeMarkerFilters.includes(term)\n        }).length\n\n      return tidsMatch !== undefined\n    })\n\n    setIsSelected(isCategorySelected.length > 0 ? true : false)\n\n    // If no filters are selected, reset state to intital\n    if (activeMarkerFilters.length === 0) {\n      setIsSelected(false)\n      setCurrentTids([])\n    }\n  }, [activeMarkerFilters, currentTids])\n\n  // Hide/show category buttons\n  function handleToggleCategory() {\n    setOpen(!open)\n  }\n\n  function handleParentCategoryFilter(tid: number, children: TaxonomyEntity[]) {\n    // Get child term IDs as array to cross reference against state\n    const childTids = children.map(term => term.tid)\n\n    // If child terms are present, remove them\n    const childrenToRemove = activeMarkerFilters.filter(function (el) {\n      return childTids.includes(el)\n    })\n\n    // Remove child TIDs from state - look in to more performant way to achieve this\n    if (childrenToRemove.length > 0)\n      childrenToRemove.forEach(tid => {\n        dispatch({\n          type: AppState.ACTIVE_MARKER_CATEGORIES,\n          mode: tid,\n        })\n      })\n\n    // Add parent TID to state\n    dispatch({\n      type: AppState.ACTIVE_MARKER_CATEGORIES,\n      mode: tid,\n    })\n\n    // Toggle category in/out of state to manage parent button selected state\n    const updatedTids = updateActiveCategories(tid, currentTids, mapRef)\n    setCurrentTids(updatedTids)\n  }\n\n  function handleChildCategoryFilter(childTid: number, parentTid: number) {\n    // Check if parent TID is in state, if so, remove it\n    if (activeMarkerFilters.includes(parentTid)) {\n      dispatch({\n        type: AppState.ACTIVE_MARKER_CATEGORIES,\n        mode: parentTid,\n      })\n    }\n\n    // Add child TID to state\n    dispatch({\n      type: AppState.ACTIVE_MARKER_CATEGORIES,\n      mode: childTid,\n    })\n\n    // Toggle category in/out of state to manage parent button selected state\n    const updatedTids = updateActiveCategories(childTid, currentTids, mapRef)\n    setCurrentTids(updatedTids)\n  }\n\n  function checkHasIcon(term: TaxonomyEntity) {\n    const hasIcon = markerIcons.filter((icon: number) => term.tid === icon)\n\n    return (\n      <img\n        src={`${\n          window.location.origin\n        }/wp-content/themes/chilterns/dist/img/map/plain/${\n          hasIcon ? +hasIcon : 0\n        }.svg`}\n        alt=\"Marker icon\"\n      />\n    )\n  }\n\n  return (\n    <>\n      <Button\n        classes={`category-label ${open && 'active'} ${\n          isSelected && 'selected'\n        }`}\n        clicked={handleToggleCategory}\n        ariaLabel={`Click to toggle ${htmlDecode(\n          category.name\n        )} category filters`}\n        data-tid={category.tid}\n      >\n        <span role=\"img\" aria-label=\"Category arrow\"></span>\n        {htmlDecode(category.name)}\n      </Button>\n\n      <AnimatePresence>\n        {open && (\n          <motion.div\n            className=\"filters-dropdown\"\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            transition={{ ease: 'easeInOut' }}\n          >\n            <Button\n              clicked={() =>\n                handleParentCategoryFilter(category.tid, category.children)\n              }\n              classes={`category ${\n                activeMarkerFilters.includes(category.tid) && 'active'\n              }`}\n            >\n              <span\n                className=\"check\"\n                role=\"checkbox\"\n                aria-checked={activeMarkerFilters.includes(category.tid)}\n                aria-label=\"Visual check for category\"\n              ></span>\n              See all {htmlDecode(category.name)}\n              {checkHasIcon(category)}\n            </Button>\n\n            {category.children.map((childCategory: TaxonomyEntity) => (\n              <Button\n                key={childCategory.tid}\n                clicked={() =>\n                  handleChildCategoryFilter(childCategory.tid, category.tid)\n                }\n                classes={`category ${\n                  activeMarkerFilters.includes(childCategory.tid) && 'active'\n                }`}\n              >\n                <span\n                  className=\"check\"\n                  role=\"checkbox\"\n                  aria-checked={activeMarkerFilters.includes(childCategory.tid)}\n                  aria-label=\"Visual check for category\"\n                ></span>\n                {htmlDecode(childCategory.name)}\n                {checkHasIcon(childCategory)}\n              </Button>\n            ))}\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </>\n  )\n}\n"],"mappings":"mIAAA,OAASA,UAAT,CAAqBC,SAArB,CAAgCC,QAAhC,KAAgD,OAAhD,CACA,OAASC,UAAT,KAA2B,eAA3B,CACA,OAASC,eAAT,CAA0BC,YAA1B,KAA8C,cAA9C,CACA,MAAOC,OAAP,KAAmB,iBAAnB,CACA,OACEC,QADF,KAKO,mBALP,CAMA,OAASC,eAAT,CAA0BC,MAA1B,KAAwC,eAAxC,CACA,OAASC,WAAT,KAA4B,wBAA5B,CACA,MAAOC,uBAAP,KAAmC,oCAAnC,C,6IAMA;AACA;AACA,GACA,cAAe,SAASC,eAAT,MAA6C,IAAnBC,SAAmB,MAAnBA,QAAmB,CAC1D,cAAwBX,QAAQ,CAAU,KAAV,CAAhC,wCAAOY,IAAP,eAAaC,OAAb,eACA,eAAsCb,QAAQ,CAAQ,EAAR,CAA9C,yCAAOc,WAAP,eAAoBC,cAApB,eACA,eAAoCf,QAAQ,CAAU,KAAV,CAA5C,yCAAOgB,UAAP,eAAmBC,aAAnB,eACA,UAAqBnB,UAAU,CAACI,eAAD,CAA/B,CAAQgB,QAAR,OAAQA,QAAR,CACA,UAAkBpB,UAAU,CAACK,YAAD,CAA5B,CAAQgB,KAAR,OAAQA,KAAR,CACA,GAAQC,oBAAR,CAAwCD,KAAxC,CAAQC,mBAAR,CAA6BC,MAA7B,CAAwCF,KAAxC,CAA6BE,MAA7B,CAEAtB,SAAS,CAAC,UAAM,CACd;AACA,GAAMuB,mBAAkB,CAAGR,WAAW,CAACS,MAAZ,CAAmB,SAAAC,GAAG,CAAI,CACnD,GAAMC,UAAS,CACbX,WAAW,CAACY,MAAZ,CAAqB,CAArB,EACAF,GAAG,CAACD,MAAJ,CAAW,SAACI,IAAD,CAAkB,CAC3B,MAAOP,oBAAmB,CAACQ,QAApB,CAA6BD,IAA7B,CAAP,CACD,CAFD,EAEGD,MAJL,CAMA,MAAOD,UAAS,GAAKI,SAArB,CACD,CAR0B,CAA3B,CAUAZ,aAAa,CAACK,kBAAkB,CAACI,MAAnB,CAA4B,CAA5B,CAAgC,IAAhC,CAAuC,KAAxC,CAAb,CAEA;AACA,GAAIN,mBAAmB,CAACM,MAApB,GAA+B,CAAnC,CAAsC,CACpCT,aAAa,CAAC,KAAD,CAAb,CACAF,cAAc,CAAC,EAAD,CAAd,CACD,CACF,CAnBQ,CAmBN,CAACK,mBAAD,CAAsBN,WAAtB,CAnBM,CAAT,CAqBA;AACA,QAASgB,qBAAT,EAAgC,CAC9BjB,OAAO,CAAC,CAACD,IAAF,CAAP,CACD,CAED,QAASmB,2BAAT,CAAoCP,GAApC,CAAiDQ,QAAjD,CAA6E,CAC3E;AACA,GAAMC,UAAS,CAAGD,QAAQ,CAACE,GAAT,CAAa,SAAAP,IAAI,QAAIA,KAAI,CAACH,GAAT,EAAjB,CAAlB,CAEA;AACA,GAAMW,iBAAgB,CAAGf,mBAAmB,CAACG,MAApB,CAA2B,SAAUa,EAAV,CAAc,CAChE,MAAOH,UAAS,CAACL,QAAV,CAAmBQ,EAAnB,CAAP,CACD,CAFwB,CAAzB,CAIA;AACA,GAAID,gBAAgB,CAACT,MAAjB,CAA0B,CAA9B,CACES,gBAAgB,CAACE,OAAjB,CAAyB,SAAAb,GAAG,CAAI,CAC9BN,QAAQ,CAAC,CACPoB,IAAI,CAAEjC,QAAQ,CAACkC,wBADR,CAEPC,IAAI,CAAEhB,GAFC,CAAD,CAAR,CAID,CALD,EAOF;AACAN,QAAQ,CAAC,CACPoB,IAAI,CAAEjC,QAAQ,CAACkC,wBADR,CAEPC,IAAI,CAAEhB,GAFC,CAAD,CAAR,CAKA;AACA,GAAMiB,YAAW,CAAGhC,sBAAsB,CAACe,GAAD,CAAMV,WAAN,CAAmBO,MAAnB,CAA1C,CACAN,cAAc,CAAC0B,WAAD,CAAd,CACD,CAED,QAASC,0BAAT,CAAmCC,QAAnC,CAAqDC,SAArD,CAAwE,CACtE;AACA,GAAIxB,mBAAmB,CAACQ,QAApB,CAA6BgB,SAA7B,CAAJ,CAA6C,CAC3C1B,QAAQ,CAAC,CACPoB,IAAI,CAAEjC,QAAQ,CAACkC,wBADR,CAEPC,IAAI,CAAEI,SAFC,CAAD,CAAR,CAID,CAED;AACA1B,QAAQ,CAAC,CACPoB,IAAI,CAAEjC,QAAQ,CAACkC,wBADR,CAEPC,IAAI,CAAEG,QAFC,CAAD,CAAR,CAKA;AACA,GAAMF,YAAW,CAAGhC,sBAAsB,CAACkC,QAAD,CAAW7B,WAAX,CAAwBO,MAAxB,CAA1C,CACAN,cAAc,CAAC0B,WAAD,CAAd,CACD,CAED,QAASI,aAAT,CAAsBlB,IAAtB,CAA4C,CAC1C,GAAMmB,QAAO,CAAGtC,WAAW,CAACe,MAAZ,CAAmB,SAACwB,IAAD,QAAkBpB,KAAI,CAACH,GAAL,GAAauB,IAA/B,EAAnB,CAAhB,CAEA,mBACE,YACE,GAAG,WACDC,MAAM,CAACC,QAAP,CAAgBC,MADf,4DAGDJ,OAAO,CAAG,CAACA,OAAJ,CAAc,CAHpB,QADL,CAME,GAAG,CAAC,aANN,EADF,CAUD,CAED,mBACE,wCACE,MAAC,MAAD,EACE,OAAO,0BAAoBlC,IAAI,EAAI,QAA5B,aACLI,UAAU,EAAI,UADT,CADT,CAIE,OAAO,CAAEc,oBAJX,CAKE,SAAS,2BAAqB7B,UAAU,CACtCU,QAAQ,CAACwC,IAD6B,CAA/B,qBALX,CAQE,WAAUxC,QAAQ,CAACa,GARrB,wBAUE,aAAM,IAAI,CAAC,KAAX,CAAiB,aAAW,gBAA5B,EAVF,CAWGvB,UAAU,CAACU,QAAQ,CAACwC,IAAV,CAXb,GADF,cAeE,KAAC,eAAD,WACGvC,IAAI,eACH,MAAC,MAAD,CAAQ,GAAR,EACE,SAAS,CAAC,kBADZ,CAEE,OAAO,CAAE,CAAEwC,OAAO,CAAE,CAAX,CAFX,CAGE,OAAO,CAAE,CAAEA,OAAO,CAAE,CAAX,CAHX,CAIE,IAAI,CAAE,CAAEA,OAAO,CAAE,CAAX,CAJR,CAKE,UAAU,CAAE,CAAEC,IAAI,CAAE,WAAR,CALd,wBAOE,MAAC,MAAD,EACE,OAAO,CAAE,yBACPtB,2BAA0B,CAACpB,QAAQ,CAACa,GAAV,CAAeb,QAAQ,CAACqB,QAAxB,CADnB,EADX,CAIE,OAAO,oBACLZ,mBAAmB,CAACQ,QAApB,CAA6BjB,QAAQ,CAACa,GAAtC,GAA8C,QADzC,CAJT,wBAQE,aACE,SAAS,CAAC,OADZ,CAEE,IAAI,CAAC,UAFP,CAGE,eAAcJ,mBAAmB,CAACQ,QAApB,CAA6BjB,QAAQ,CAACa,GAAtC,CAHhB,CAIE,aAAW,2BAJb,EARF,YAcWvB,UAAU,CAACU,QAAQ,CAACwC,IAAV,CAdrB,CAeGN,YAAY,CAAClC,QAAD,CAff,GAPF,CAyBGA,QAAQ,CAACqB,QAAT,CAAkBE,GAAlB,CAAsB,SAACoB,aAAD,qBACrB,MAAC,MAAD,EAEE,OAAO,CAAE,yBACPZ,0BAAyB,CAACY,aAAa,CAAC9B,GAAf,CAAoBb,QAAQ,CAACa,GAA7B,CADlB,EAFX,CAKE,OAAO,oBACLJ,mBAAmB,CAACQ,QAApB,CAA6B0B,aAAa,CAAC9B,GAA3C,GAAmD,QAD9C,CALT,wBASE,aACE,SAAS,CAAC,OADZ,CAEE,IAAI,CAAC,UAFP,CAGE,eAAcJ,mBAAmB,CAACQ,QAApB,CAA6B0B,aAAa,CAAC9B,GAA3C,CAHhB,CAIE,aAAW,2BAJb,EATF,CAeGvB,UAAU,CAACqD,aAAa,CAACH,IAAf,CAfb,CAgBGN,YAAY,CAACS,aAAD,CAhBf,GACOA,aAAa,CAAC9B,GADrB,CADqB,EAAtB,CAzBH,GAFJ,EAfF,GADF,CAoED"},"metadata":{},"sourceType":"module"}